# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/configuration-reference
# https://circleci.com/blog/deploy-aws-lambda-cdk/
version: 2.1

# reusable config
orbs:
  aws-cli: circleci/aws-cli@2.0.6

# Specify the execution environment. You can specify an image from Docker Hub or use one of our convenience images from CircleCI's Developer Hub.
# See: https://circleci.com/docs/configuration-reference/#executor-job
executors:
  default:
    docker:
      - image: 'cimg/node:18.16.0'
    environment:
      AWS_REGION: 'eu-west-2'

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/configuration-reference/#jobs
jobs:
  build:
    executor: 'default'
    steps:
      - checkout
      - run: node --version
      - run:
          name: Run tests with code coverage
          command: npm run coverage

# Orchestrate jobs using workflows
# See: https://circleci.com/docs/configuration-reference/#workflows
workflows:
  aws-cli:
    jobs:
      - build
